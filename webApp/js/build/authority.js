"use strict";layui.use(["layer","myExtend","form"],function(){var o=layui.layer,r=layui.form,u=layui.jquery,c=layui.myExtend;new Vue({el:"#role-list",data:{list_role:[],handle:[],menu:[],current_role:0,panel:0},methods:{authority:function(t,e){var i=(t[e]||"0").split("");this.current_role=t.id;for(var n=0,a=this[e].length;n<a;n++){var l=this[e];i[n]&&1==+i[n]?l[n].checked=1:(i[n]=0,l[n].checked=0)}t[e]=i.join(""),this.list_ctr=this[e],this.showModal(t,e),this.$nextTick(function(){r.render("checkbox","form-list")})},showModal:function(t,a){var l=this,e=o.open({type:1,title:"修改权限",area:"400px",content:function(){for(var t=l[a],e='<form id="form-list" class="layui-form layui-hidden" lay-filter="form-list">\n                                        <div class="layui-item">\n                                            <div class="layui-input-block">',i=0,n=t.length;i<n;i++)e+='<input type="checkbox" lay-skin="primary"\n                                    '+(t[i].checked?"checked":"")+' title="'+t[i].name+'">';return e+="</div></div></form>"}(),btn:"确认",btnAlign:"c",yes:function(){l.update(e,t,a)},id:(new Date).getTime().toString()})},update:function(e,i,a){var l=this,t=u("#form-list .layui-input-block > input"),r=i[a].split(""),n={role:this.current_role};t.map(function(t,e){var i=l[a][t];if(u(e).attr("title")===i.name){var n=e.checked?1:0;i.checked=n,r[t]=n}}),n[a]=r.join(""),c.http_post({url:"/system/admin/update_role_authority",data:n,callback:function(t){o.close(e),c.normal_open(t.data.errmsg,(new Date).getTime().toString()),i[a]=r.join("")}})}},components:{"my-role":{props:["item"],template:"<tr><td v-text='item.name'></td><td><button class='layui-btn layui-btn-sm' @click='authority(\"handle\")'>修改</button></td><td><button class='layui-btn layui-btn-sm' @click='authority(\"menu\")'>修改</button></td></tr>",methods:{authority:function(t){this.$emit("authority",this.item,t)}}}},mounted:function(){var i=this;c.http_post({url:"/system/admin/role_list",callback:function(t){var e=t.data.data;i.list_role=e.role,i.handle=e.handle.map(function(t){return t.checked=0,t}),i.menu=e.menu.map(function(t){return t.checked=0,t})}})}})});